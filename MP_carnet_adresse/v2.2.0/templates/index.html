{% extends "base.html" %}

{% block title %}Liste des contacts{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-6">
        <h1><i class="bi bi-people-fill"></i> Mes Contacts</h1>
        <p class="text-muted">
            {% if recherche %}
                R√©sultats pour "{{ recherche }}" : {{ contacts|length }} contact(s)
            {% else %}
                {{ contacts|length }} contact(s) au total
            {% endif %}
        </p>
    </div>
    <div class="col-md-6">
        <form method="GET" action="{{ url_for('rechercher') }}" class="d-flex mb-2">
            <input type="text" name="q" class="form-control me-2" 
                   placeholder="üîç Rechercher..." value="{{ recherche or '' }}">
            <button type="submit" class="btn btn-outline-primary">
                <i class="bi bi-search"></i>
            </button>
        </form>
        
        <!-- Filtres par cat√©gorie -->
        <div class="btn-group btn-group-sm w-100" role="group">
            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                <i class="bi bi-list"></i> Tous
            </a>
            <a href="{{ url_for('filtrer_categorie', categorie='Personnel') }}" class="btn btn-outline-primary">
                <i class="bi bi-person"></i> Personnel
            </a>
            <a href="{{ url_for('filtrer_categorie', categorie='Entreprise') }}" class="btn btn-outline-info">
                <i class="bi bi-building"></i> Entreprise
            </a>
            <a href="{{ url_for('filtrer_categorie', categorie='Client') }}" class="btn btn-outline-success">
                <i class="bi bi-bag"></i> Clients
            </a>
            <a href="{{ url_for('filtrer_categorie', categorie='Fournisseur') }}" class="btn btn-outline-warning">
                <i class="bi bi-truck"></i> Fournisseurs
            </a>
        </div>
    </div>
</div>

{% if contacts %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-primary">
            <tr>
                <th>#</th>
                <th><i class="bi bi-bookmark"></i> Cat√©gorie</th>
                <th><i class="bi bi-person"></i> Nom</th>
                <th><i class="bi bi-person"></i> Pr√©nom</th>
                <th><i class="bi bi-envelope"></i> Email</th>
                <th><i class="bi bi-telephone"></i> T√©l√©phone</th>
                <th><i class="bi bi-building"></i> Entreprise</th>
                <th class="text-center"><i class="bi bi-gear"></i> Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for contact in contacts %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    {% if contact.categorie == 'Personnel' %}
                        <span class="badge bg-primary">{{ contact.categorie }}</span>
                    {% elif contact.categorie == 'Entreprise' %}
                        <span class="badge bg-info">{{ contact.categorie }}</span>
                    {% elif contact.categorie == 'Client' %}
                        <span class="badge bg-success">{{ contact.categorie }}</span>
                    {% elif contact.categorie == 'Fournisseur' %}
                        <span class="badge bg-warning text-dark">{{ contact.categorie }}</span>
                    {% endif %}
                </td>
                <td><strong>{{ contact.nom }}</strong></td>
                <td><strong>{{ contact.prenom }}</strong></td>
                <td>
                    <a href="mailto:{{ contact.email }}" class="text-decoration-none">
                        {{ contact.email }}
                    </a>
                </td>
                <td>
                    <a href="tel:{{ contact.telephone }}" class="text-decoration-none">
                        {{ contact.telephone }}
                    </a>
                </td>
                <td>
                    {% if contact.entreprise %}
                        <small>{{ contact.entreprise }}</small>
                    {% else %}
                        <small class="text-muted">-</small>
                    {% endif %}
                </td>
                <td class="text-center">
                    <div class="btn-group btn-group-sm" role="group">
                        <!-- Voir d√©tails -->
                        <button type="button" class="btn btn-secondary" 
                                data-bs-toggle="modal" 
                                data-bs-target="#detailsModal{{ loop.index }}"
                                title="Voir d√©tails">
                            <i class="bi bi-eye"></i>
                        </button>
                        
                        <!-- Email -->
                        <a href="{{ url_for('envoyer_email', nom=contact.nom, prenom=contact.prenom) }}" 
                           class="btn btn-info" 
                           title="Envoyer un email">
                            <i class="bi bi-envelope-fill"></i>
                        </a>
                        
                        <!-- WhatsApp -->
                        <a href="{{ url_for('whatsapp', nom=contact.nom, prenom=contact.prenom) }}" 
                           class="btn btn-success" 
                           title="WhatsApp"
                           target="_blank">
                            <i class="bi bi-whatsapp"></i>
                        </a>
                        
                        <!-- Modifier -->
                        <a href="{{ url_for('modifier', nom=contact.nom, prenom=contact.prenom) }}" 
                           class="btn btn-warning" 
                           title="Modifier">
                            <i class="bi bi-pencil"></i>
                        </a>
                        
                        <!-- Supprimer -->
                        <a href="{{ url_for('supprimer', nom=contact.nom, prenom=contact.prenom) }}" 
                           class="btn btn-danger" 
                           onclick="return confirm('Supprimer {{ contact.nom }} {{ contact.prenom }} ?')"
                           title="Supprimer">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            
            <!-- Modal d√©tails -->
            <div class="modal fade" id="detailsModal{{ loop.index }}" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title">
                                <i class="bi bi-person-circle"></i> {{ contact.get_nom_complet() }}
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%"><i class="bi bi-bookmark"></i> Cat√©gorie :</th>
                                    <td>
                                        {% if contact.categorie == 'Personnel' %}
                                            <span class="badge bg-primary">{{ contact.categorie }}</span>
                                        {% elif contact.categorie == 'Entreprise' %}
                                            <span class="badge bg-info">{{ contact.categorie }}</span>
                                        {% elif contact.categorie == 'Client' %}
                                            <span class="badge bg-success">{{ contact.categorie }}</span>
                                        {% elif contact.categorie == 'Fournisseur' %}
                                            <span class="badge bg-warning text-dark">{{ contact.categorie }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th><i class="bi bi-person"></i> Nom complet :</th>
                                    <td><strong>{{ contact.get_nom_complet() }}</strong></td>
                                </tr>
                                <tr>
                                    <th><i class="bi bi-envelope"></i> Email :</th>
                                    <td>{{ contact.email }}</td>
                                </tr>
                                <tr>
                                    <th><i class="bi bi-telephone"></i> T√©l√©phone :</th>
                                    <td>{{ contact.telephone }}</td>
                                </tr>
                                {% if contact.adresse %}
                                <tr>
                                    <th><i class="bi bi-geo-alt"></i> Adresse :</th>
                                    <td>{{ contact.adresse }}</td>
                                </tr>
                                {% endif %}
                                {% if contact.entreprise %}
                                <tr>
                                    <th><i class="bi bi-building"></i> Entreprise :</th>
                                    <td>{{ contact.entreprise }}</td>
                                </tr>
                                {% endif %}
                                {% if contact.fonction %}
                                <tr>
                                    <th><i class="bi bi-briefcase"></i> Fonction :</th>
                                    <td>{{ contact.fonction }}</td>
                                </tr>
                                {% endif %}
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info text-center">
    <i class="bi bi-info-circle" style="font-size: 2rem;"></i>
    <p class="mt-2 mb-0">
        {% if recherche %}
            Aucun contact trouv√© pour "{{ recherche }}".
        {% else %}
            Aucun contact dans le carnet. Commencez par en ajouter un !
        {% endif %}
    </p>
    {% if not recherche %}
    <a href="{{ url_for('ajouter') }}" class="btn btn-primary mt-3">
        <i class="bi bi-plus-circle"></i> Ajouter un contact
    </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}